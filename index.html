<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dino Quest â€” Arena</title>
<style>
:root{--bg:#070b12;--panel:#0f1828;--panel2:#0c1421;--txt:#e8f0ff;--border:#22324c;--gold:#f6c960;--gems:#7dd3fc;--hp1:#22d3ee;--hp2:#38bdf8;--accent:#8b5cf6;--ok:#34d399}
*{box-sizing:border-box}html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
button{cursor:pointer}
.hud{position:fixed;inset:0 0 auto 0;z-index:50;display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;padding:10px 12px;background:linear-gradient(180deg,#0c1421,#0a1120);border-bottom:1px solid var(--border)}
.brand{font-weight:900}
.badge{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg,#101a2a,#0c1523)}
.ham{width:40px;height:40px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg,#101a2a,#0c1523);color:#eaf1ff;font-size:20px}
.stage{position:fixed;inset:56px 0 0 0; /* sous le HUD, plein Ã©cran */ }
.scene{position:absolute;inset:0;overflow:hidden}
.bg-forest{background:radial-gradient(1200px 800px at 50% -120px,rgba(14,40,30,.5),transparent 55%),linear-gradient(180deg,#0b2b21,#08131a 65%,#070b12)}
.bg-desert{background:radial-gradient(1200px 800px at 50% -120px,rgba(60,48,12,.42),transparent 55%),linear-gradient(180deg,#2a220e,#0f1216 65%,#070b12)}
.bg-volcano{background:radial-gradient(1200px 800px at 50% -120px,rgba(70,16,16,.45),transparent 55%),linear-gradient(180deg,#2a1212,#0f1216 65%,#070b12)}
.bg-glacier{background:radial-gradient(1200px 800px at 50% -120px,rgba(12,50,80,.4),transparent 55%),linear-gradient(180deg,#12253a,#0e1420 65%,#070b12)}
.ring{position:absolute;width:260px;height:84px;border-radius:50%;background:radial-gradient(closest-side,rgba(170,210,255,.16),transparent 70%);outline:1px solid rgba(120,160,200,.2)}
.ring.ally{left:36px;bottom:46px}.ring.enemy{right:36px;top:96px;transform:scale(.95)}
.aura{position:absolute;filter:blur(16px);opacity:.6}.aura.ally{left:36px;bottom:28px;width:220px;height:30px;background:radial-gradient(ellipse,#8b5cf6,.0)}.aura.enemy{right:36px;top:76px;width:220px;height:30px;background:radial-gradient(ellipse,#22d3ee,.0)}
.sprite{position:absolute;filter:drop-shadow(0 18px 28px rgba(0,0,0,.55))}
.sprite.ally{left:70px;bottom:90px;font-size:92px;animation:float 3s ease-in-out infinite}
.sprite.enemy{right:92px;top:84px;font-size:92px;animation:float 3.2s ease-in-out infinite reverse}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.card{position:absolute;border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg,#101a24,#0e1626);padding:10px;box-shadow:0 12px 26px rgba(0,0,0,.28)}
.card.enemy{right:16px;top:16px;min-width:260px}.card.ally{left:16px;bottom:16px;min-width:280px}
.name{font-weight:800;margin-bottom:6px}.stat{opacity:.85;font-size:13px}
.hp{height:10px;background:#0a1220;border:1px solid #20304d;border-radius:8px;overflow:hidden;margin-top:8px}
.hp>i{display:block;height:100%;background:linear-gradient(90deg,var(--hp1),var(--hp2))}
.msg{position:absolute;left:50%;transform:translateX(-50%);bottom:24px;background:linear-gradient(180deg,#0f1828,#0b1423);border:1px dashed var(--border);border-radius:12px;padding:8px 12px;opacity:.95}
.speed{position:absolute;right:14px;bottom:14px;display:flex;gap:8px;align-items:center;background:linear-gradient(180deg,#101a2a,#0c1523);border:1px solid var(--border);border-radius:12px;padding:8px 10px}
.speed .label{font-size:12px;opacity:.85}.speed button{min-width:42px;padding:6px 8px;border:1px solid #2a3a58;border-radius:10px;background:#0f1828;color:#dfe7ff;font-weight:700}
.speed button.active{box-shadow:0 0 0 2px rgba(139,92,246,.35) inset}
.menu{position:fixed;top:56px;right:-320px;width:300px;height:calc(100dvh - 56px);background:linear-gradient(180deg,#0e1728,#0b1423);border-left:1px solid var(--border);padding:16px;display:flex;flex-direction:column;gap:8px;z-index:60;transition:right .18s}
.menu.open{right:0}.menu a{display:block;padding:12px;border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg,#0f1828,#0b1423);color:var(--txt);text-decoration:none}
.panel{position:fixed;inset:56px 0 0 0;background:radial-gradient(1200px 700px at 50% -200px,#0e1a2a,#0a0f17);display:none;z-index:55;overflow:auto}
.panel.open{display:block}.inner{padding:16px;max-width:1100px;margin:0 auto}
.back{position:sticky;top:0;display:inline-flex;gap:8px;align-items:center;margin:-8px 0 8px;padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#101a2a}
.grid6{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:10px}.row{display:flex;gap:10px;flex-wrap:wrap}
.btn{display:inline-flex;gap:8px;align-items:center;padding:10px 14px;border:1px solid #2a3a58;border-radius:12px;background:#132039;color:var(--txt);text-decoration:none;font-weight:700}
.small{opacity:.85;font-size:12px}
.tile,.chest,.card2{border:1px solid var(--border);border-radius:14px;background:linear-gradient(180deg,#101a24,#0e1626);padding:12px;box-shadow:0 10px 22px rgba(0,0,0,.25)}
.summon-actions{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin:8px 0 12px}
.price{display:inline-flex;gap:6px;align-items:center;border:1px solid #2a3a58;border-radius:10px;padding:4px 8px;background:#132039}
.chests{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
.chest-basic{box-shadow:0 0 0 2px rgba(160,160,160,.18) inset}.chest-rare{box-shadow:0 0 0 2px rgba(96,165,250,.25) inset}.chest-supreme{box-shadow:0 0 0 2px rgba(245,158,11,.25) inset}
/* Overlay results */
.modal{position:fixed;inset:56px 0 0 0;background:rgba(6,10,18,.88);backdrop-filter:blur(2px);display:none;z-index:80;overflow:auto}
.modal.open{display:block}.modal .wrap{max-width:1100px;margin:0 auto;padding:16px}
.resultGrid{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:12px}
.result{border:1px solid var(--border);border-radius:14px;background:linear-gradient(180deg,#101a24,#0e1626);padding:12px;text-align:center;animation:pop .22s ease}
@keyframes pop{from{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}
.sparkle{position:relative}.sparkle:after{content:"";position:absolute;inset:-2px;border-radius:14px;box-shadow:0 0 24px rgba(139,92,246,.35);animation:pulse 1.2s ease-in-out 2}
@keyframes pulse{0%,100%{opacity:.7}50%{opacity:1}}
.leader{display:flex;align-items:center;gap:12px;padding:10px;border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg,#0f1828,#0b1423)}
</style>
</head>
<body>
<div class="hud">
  <div class="brand">Dino Quest</div>
  <div class="status">
    <div class="badge">Lvl <span id="lvl" style="margin-left:6px">1</span></div>
    <div class="badge">ğŸª™ <span id="gold">0</span></div>
    <div class="badge">ğŸ’ <span id="gems">0</span></div>
  </div>
  <button id="ham" class="ham" aria-expanded="false">â˜°</button>
</div>

<nav id="menu" class="menu">
  <a href="#" data-panel="profile">Profil</a>
  <a href="#" data-panel="improve">AmÃ©liorations</a>
  <a href="#" data-panel="summon">Tirage & Coffres</a>
  <a href="#" data-panel="bag">Inventaire</a>
  <a href="#" data-panel="equip">Ã‰quipement</a>
  <a href="#" data-panel="dex">Classeur</a>
  <a href="#" data-panel="rank">Classement</a>
  <a href="#" data-panel="promo">Code Promo</a>
  <a href="#" id="reset">Reset sauvegarde</a>
</nav>

<!-- FULLSCREEN STAGE -->
<div class="stage">
  <div id="scene" class="scene bg-forest">
    <div class="ring ally"></div><div class="ring enemy"></div>
    <div class="aura ally"></div><div class="aura enemy"></div>
    <div id="enemySprite" class="sprite enemy">ğŸ¦</div>
    <div id="allySprite" class="sprite ally">ğŸ¦•</div>

    <div class="card enemy">
      <div class="name" id="enemyName">Niv. 1 â€” LÃ©zard Sauvage</div>
      <div class="hp"><i id="enemyHP" style="width:100%"></i></div>
      <div class="stat" id="enemyStats">ATK 0 â€¢ DEF 0</div>
    </div>
    <div class="card ally">
      <div class="name" id="allyName">Petit Raptor â€” BASIC</div>
      <div class="hp"><i id="allyHP" style="width:100%"></i></div>
      <div class="stat" id="allyStats">PV 0 â€¢ ATK 0 â€¢ DEF 0 â€¢ VIT 0</div>
    </div>

    <div class="speed">
      <div class="label">Vitesse dâ€™attaque</div>
      <button data-sp="1" class="active">x1</button>
      <button data-sp="2">x2</button>
      <button data-sp="3">x3</button>
    </div>

    <div class="msg" id="msg">Combat auto â€” Boss tous les 10 niveaux : +10 ğŸ’</div>
  </div>
</div>

<!-- PANELS (each has â† Retour) -->
<div id="panel-profile" class="panel"><div class="inner">
  <button class="back" data-back>â† Retour</button>
  <h3>Profil</h3>
  <div class="row">
    <input id="profileName" class="badge" placeholder="Ton pseudo" style="padding:8px 10px">
    <button class="btn" id="saveProfile">Sauvegarder</button>
  </div>
  <div class="grid6" id="profileStats" style="margin-top:10px"></div>
  <h4>Ã‰quipe actuelle</h4><div class="grid6" id="profileTeam"></div>
  <p class="small" id="profileId"></p>
</div></div>

<div id="panel-improve" class="panel"><div class="inner">
  <button class="back" data-back>â† Retour</button>
  <h3>AmÃ©liorations</h3>
  <p class="small">Tap sur un dino pour <b>Ã©quiper</b> / gÃ©rer lâ€™Ã©quipe.</p>
  <div id="improveTeam" class="row" style="margin-bottom:10px"></div>
  <div class="row" id="upBtns"></div>
</div></div>

<div id="panel-summon" class="panel"><div class="inner">
  <button class="back" data-back>â† Retour</button>
  <h3>Tirage & Coffres</h3>
  <div class="summon-actions">
    <button class="tile" id="btn-pull1"><div style="font-size:34px">ğŸ´</div><div><div class="name">Tirage unique</div><div class="small">Un dino</div><div class="price">ğŸ’ 100</div></div></button>
    <button class="tile" id="btn-pull10"><div style="font-size:34px">ğŸ´ğŸ´</div><div><div class="name">Tirage x10</div><div class="small">Dix dâ€™un coup</div><div class="price">ğŸ’ 1000</div></div></button>
  </div>
  <h4>Coffres dâ€™Ã©quipement (Or)</h4>
  <div class="chests">
    <button class="chest chest-basic" id="chest-basic"><div style="font-size:30px">ğŸ§°</div><div class="name">Basic</div><div class="small">Ã‰quipement commun</div><div class="price">ğŸª™ 1 000</div></button>
    <button class="chest chest-rare" id="chest-rare"><div style="font-size:30px">ğŸ§°</div><div class="name">Rare</div><div class="small">AmÃ©liorÃ©</div><div class="price">ğŸª™ 5 000</div></button>
    <button class="chest chest-supreme" id="chest-supreme"><div style="font-size:30px">ğŸ§°</div><div class="name">SuprÃªme</div><div class="small">Puissant</div><div class="price">ğŸª™ 15 000</div></button>
  </div>
</div></div>

<div id="panel-bag" class="panel"><div class="inner">
  <button class="back" data-back>â† Retour</button>
  <h3>Inventaire (consommables)</h3>
  <div id="bag" class="grid6"></div>
</div></div>

<div id="panel-equip" class="panel"><div class="inner">
  <button class="back" data-back>â† Retour</button>
  <h3>Ã‰quipement</h3>
  <div class="row" id="equipTeam"></div>
  <div class="grid6">
    <div class="tile"><div class="name">Arme</div><div id="slot-weapon">vide</div></div>
    <div class="tile"><div class="name">Armure</div><div id="slot-armor">vide</div></div>
    <div class="tile"><div class="name">Amulette</div><div id="slot-amulet">vide</div></div>
  </div>
</div></div>

<div id="panel-dex" class="panel"><div class="inner">
  <button class="back" data-back>â† Retour</button>
  <h3>Classeur</h3>
  <div id="dex" class="grid6"></div>
</div></div>

<div id="panel-rank" class="panel"><div class="inner">
  <button class="back" data-back>â† Retour</button>
  <h3>Classement</h3>
  <div id="rankList" class="row" style="flex-direction:column"></div>
</div></div>

<div id="panel-promo" class="panel"><div class="inner">
  <button class="back" data-back>â† Retour</button>
  <h3>Code Promo</h3>
  <div class="row"><input id="promoInput" class="badge" placeholder="Entrez un codeâ€¦"><button class="btn" id="applyPromo">Valider</button></div>
  <p class="small">Utilise <b>TESTDINO</b> pour 200 000 or + 50 000 gemmes.</p>
</div></div>

<!-- Fullscreen result modal -->
<div id="modal" class="modal"><div class="wrap">
  <div class="row" style="justify-content:space-between;align-items:center">
    <h3 id="modalTitle">RÃ©sultats</h3>
    <button class="btn" id="modalClose">Fermer</button>
  </div>
  <div id="results" class="resultGrid"></div>
</div></div>

<script>
/* === State === */
const S = JSON.parse(localStorage.getItem("dq_save")||"{}");
S.lvl??=1; S.gold??=0; S.gems??=0; S.speed??=1;
S.collection??=[]; S.team??=[]; S.inv??=[]; S.equip??={weapon:null,armor:null,amulet:null};
S.equipCandidates??=[]; S.player??={id:null,name:"",stats:{kills:0,goldEarned:0,gemsEarned:0}};
if(!S.player.id) S.player.id = ("DQ-"+Math.random().toString(36).slice(2,6)+"-"+Math.random().toString(36).slice(2,6)).toUpperCase();
function save(){localStorage.setItem("dq_save",JSON.stringify(S));}

/* === Data === */
const POOL=[{key:"b_raptor",name:"Petit Raptor",emoji:"ğŸ¦•",rarity:"BASIC",hp:120,atk:8,def:2,spd:1.2},
{key:"r_raptor",name:"Raptor Agile",emoji:"ğŸ¦–",rarity:"RARE",hp:170,atk:12,def:4,spd:1.1},
{key:"e_trike",name:"TricÃ©racorps",emoji:"ğŸ¦•",rarity:"EPIC",hp:220,atk:16,def:7,spd:1.1},
{key:"l_rex",name:"T-Rex Alpha",emoji:"ğŸ¦–",rarity:"LEGEND",hp:280,atk:22,def:9,spd:1.0},
{key:"s_drake",name:"Dragon Ancien",emoji:"ğŸ²",rarity:"SUPREME",hp:340,atk:28,def:12,spd:0.9}];
const CHESTS={basic:{cost:1000,table:[{t:"weapon",n:"Griffe Ã©brÃ©chÃ©e",atk:2},{t:"armor",n:"Peau tannÃ©",def:1},{t:"amulet",n:"Perle terne",hp:15}]},
rare:{cost:5000,table:[{t:"weapon",n:"Dard poli",atk:4},{t:"armor",n:"Cuir Ã©pais",def:3},{t:"amulet",n:"Perle azur",hp:35}]},
supreme:{cost:15000,table:[{t:"weapon",n:"Crocs royaux",atk:8},{t:"armor",n:"Ã‰caille drake",def:5},{t:"amulet",n:"CÅ“ur ancien",hp:70}]}};
function clone(o){return JSON.parse(JSON.stringify(o));}
function rollDino(){const r=Math.random();let p=POOL.filter(d=>d.rarity==="BASIC");if(r<0.02)p=POOL.filter(d=>d.rarity==="SUPREME");else if(r<0.07)p=POOL.filter(d=>d.rarity==="LEGEND");else if(r<0.2)p=POOL.filter(d=>d.rarity==="EPIC");else if(r<0.45)p=POOL.filter(d=>d.rarity==="RARE");return clone(p[Math.floor(Math.random()*p.length)]);}

/* === UI helpers === */
const $=id=>document.getElementById(id);
function ui(){ $("lvl").textContent=S.lvl; $("gold").textContent=S.gold.toLocaleString('fr-FR'); $("gems").textContent=S.gems.toLocaleString('fr-FR'); }
function msg(t){$("msg").textContent=t;}
function openPanel(n){document.querySelectorAll(".panel").forEach(p=>p.classList.remove("open"));$("panel-"+n).classList.add("open");}
document.querySelectorAll("[data-back]").forEach(b=>b.onclick=()=>document.querySelectorAll(".panel").forEach(p=>p.classList.remove("open")));
const ham=$("ham"),menu=$("menu");ham.onclick=(e)=>{e.stopPropagation();menu.classList.toggle("open");ham.setAttribute("aria-expanded",menu.classList.contains("open"));};document.addEventListener("click",()=>menu.classList.remove("open"));
document.querySelectorAll('#menu a[data-panel]').forEach(a=>a.onclick=(e)=>{e.preventDefault();menu.classList.remove("open");openPanel(a.dataset.panel);if(a.dataset.panel==="improve") renderImprove();if(a.dataset.panel==="equip") renderEquip();if(a.dataset.panel==="dex") renderDex();if(a.dataset.panel==="rank") renderRank();if(a.dataset.panel==="bag") renderBag();if(a.dataset.panel==="profile") renderProfile();});

/* === Combat === */
let enemy,ally,ehp,ahp,cdE=1.4,cdA=1.2,last=0;
function biome(l){const m=l%40;return m<10?"forest":m<20?"desert":m<30?"volcano":"glacier";}
function setWorld(l){const sc=$("scene");sc.className="scene bg-"+biome(l);const boss=l%10===0,m=boss?1.6:1;base=70+(l-1)*12;enemy={name:(boss?"BOSS â€” ":"Niv. "+l+" â€” ")+"LÃ©zard Sauvage",atk:Math.floor((6+l)*m),def:Math.floor((2+l/3)*m),hp:Math.floor((base+l*10)*m),emoji:boss?"ğŸ‰":"ğŸ¦"};ehp=enemy.hp;cdE=1.4;$("enemyName").textContent=enemy.name;$("enemyStats").textContent=`ATK ${enemy.atk} â€¢ DEF ${enemy.def}`;$("enemySprite").textContent=enemy.emoji;$("enemyHP").style.width="100%";}
function useTeam(){ if(!S.team.length) S.team=[clone(POOL[0])]; ally=S.team[0]; ahp=ally.hp+(S.equip.amulet?.hp||0); cdA=ally.spd||1.2; $("allyName").textContent=`${ally.name} â€” ${ally.rarity}`; $("allyStats").textContent=`PV ${ally.hp+(S.equip.amulet?.hp||0)} â€¢ ATK ${ally.atk+(S.equip.weapon?.atk||0)} â€¢ DEF ${ally.def+(S.equip.armor?.def||0)} â€¢ VIT ${(ally.spd||1.2).toFixed(2)}s`; $("allySprite").textContent=ally.emoji;$("allyHP").style.width="100%";}
document.querySelectorAll('.speed button').forEach(b=>b.onclick=()=>{document.querySelectorAll('.speed button').forEach(x=>x.classList.remove('active'));b.classList.add('active');S.speed=b.dataset.sp|0;save();});
function renderHP(){ $("enemyHP").style.width=Math.max(0,ehp/enemy.hp*100)+"%"; $("allyHP").style.width=Math.max(0,ahp/(ally.hp+(S.equip.amulet?.hp||0))*100)+"%";}
function loop(ts){const dt=Math.min(0.05,(ts-last)/1000||0);last=ts;const mult=Number(S.speed)||1;cdA-=dt*mult;cdE-=dt*mult;if(cdA<=0){const dmg=Math.max(1,(ally.atk+(S.equip.weapon?.atk||0))-enemy.def);ehp-=dmg;cdA+=(ally.spd||1.2);}if(cdE<=0){const dmg=Math.max(1,enemy.atk-(ally.def+(S.equip.armor?.def||0)));ahp-=dmg;cdE+=1.4;}if(ehp<=0){S.player.stats.kills++;const g=10+S.lvl*2;S.gold+=g;S.player.stats.goldEarned+=g;S.lvl++;if(S.lvl%10===0){S.gems+=10;S.player.stats.gemsEarned+=10;msg("Boss vaincu ! +10 ğŸ’");}save();ui();setWorld(S.lvl);useTeam();}else if(ahp<=0){msg("DÃ©faiteâ€¦ on recommence le niveau !");useTeam();save();ui();}renderHP();requestAnimationFrame(loop);}

/* === Improve with scaling cost === */
function upCost(level){return Math.round(500*Math.pow(1.2,level));}
function gemSurcharge(level){if(level<15) return 0; return 20+Math.floor((level-15)/5)*10;}
function renderImprove(){ // team cards + upgrade buttons that use scaling costs
  const wrap=$("improveTeam"); wrap.innerHTML=S.team.slice(0,5).map((d,i)=>`<button class="tile" data-who="${i}" style="min-width:160px"><div style="font-size:26px">${d.emoji}</div><div class="name">${d.name}</div><div class="small">${d.rarity}</div></button>`).join('');
  wrap.querySelectorAll("[data-who]").forEach(b=>b.onclick=()=>openEquipModal(b.dataset.who|0));
  const d=S.team[0]; if(!d) return;
  const lvl=d._upLvl||0; const g=upCost(lvl); const gc=gemSurcharge(lvl);
  $("upBtns").innerHTML = ["hp","atk","def"].map(k=>`<button class="btn" data-up="${k}">+ ${k.toUpperCase()} â€” ğŸª™ ${g}${gc?`  â€¢  ğŸ’ ${gc}`:""}</button>`).join('');
  document.querySelectorAll("[data-up]").forEach(b=>b.onclick=()=>{const cost=upCost(d._upLvl||0), gcost=gemSurcharge(d._upLvl||0); if(S.gold<cost||S.gems<gcost) return msg("Ressources insuffisantes"); S.gold-=cost; if(gcost) S.gems-=gcost; d._upLvl=(d._upLvl||0)+1; if(b.dataset.up==="hp") d.hp+=20; if(b.dataset.up==="atk") d.atk+=2; if(b.dataset.up==="def") d.def+=1; save();ui();useTeam();renderImprove(); msg("AmÃ©lioration appliquÃ©e !");});
}

/* === Equip modal / team manager === */
const modal=$("modal"), results=$("results"), modalTitle=$("modalTitle"); $("modalClose").onclick=()=>modal.classList.remove("open");
function openEquipModal(idx){
  modalTitle.textContent="Ã‰quiper / GÃ©rer lâ€™Ã©quipe";
  results.className="resultGrid"; // 5 wide grid
  const d=S.team[idx];
  const list=[
    {label:"Arme",slot:"weapon"}, {label:"Armure",slot:"armor"}, {label:"Amulette",slot:"amulet"}
  ];
  const pool=(S.equipCandidates||[]); // simple list of all loots
  results.innerHTML = `
    <div class="result" style="grid-column:span 5;text-align:left">
      <div style="display:flex;gap:10px;align-items:center"><div style="font-size:28px">${d.emoji}</div>
      <div><div class="name">${d.name}</div><div class="small">ATK ${d.atk} â€¢ DEF ${d.def} â€¢ PV ${d.hp}</div></div>
      <button class="btn" id="teamBtn" style="margin-left:auto">GÃ©rer lâ€™Ã©quipe</button></div>
    </div>
    ${list.map(it=>`<div class="result sparkle"><div class="name">${it.label}</div><div class="small" id="slotv-${it.slot}">${S.equip[it.slot]?slotToText(S.equip[it.slot]):"vide"}</div></div>`).join('')}
    <div class="result" style="grid-column:span 5"><div class="name">Objets disponibles</div></div>
    ${pool.length?pool.map((it,i)=>`<button class="result" data-eq="${i}"><div class="name">${it.n}</div><div class="small">${it.atk?`ATK+${it.atk} `:""}${it.def?`DEF+${it.def} `:""}${it.hp?`PV+${it.hp}`:""}</div></button>`).join(''):`<div class="result small">Aucun objet obtenu encore (ouvre des coffres)</div>`}
  `;
  results.querySelectorAll("[data-eq]").forEach(b=>b.onclick=()=>{const it=pool[b.dataset.eq|0]; S.equip[it.t]=it; save(); renderEquip(); openEquipModal(idx); useTeam();});
  $("teamBtn").onclick=()=>openTeamManager();
  modal.classList.add("open");
}
function slotToText(it){return `${it.n}${it.atk?` â€¢ ATK+${it.atk}`:""}${it.def?` â€¢ DEF+${it.def}`:""}${it.hp?` â€¢ PV+${it.hp}`:""}`}
function openTeamManager(){
  modalTitle.textContent="GÃ©rer lâ€™Ã©quipe (choisis 5)";
  results.className="resultGrid";
  const owned=S.collection; if(!owned.length) return results.innerHTML="<div class='result'>Aucun dino obtenu.</div>";
  const ids=new Set(S.team.map(d=>d.key));
  results.innerHTML = owned.map((d,i)=>`<button class="result ${ids.has(d.key)?'sparkle':''}" data-pick="${i}"><div style="font-size:28px">${d.emoji}</div><div class="name">${d.name}</div><div class="small">${d.rarity}</div></button>`).join('');
  results.querySelectorAll("[data-pick]").forEach(b=>b.onclick=()=>{const x=owned[b.dataset.pick|0]; const exists=S.team.find(t=>t.key===x.key); if(exists){ S.team=S.team.filter(t=>t.key!==x.key); } else { if(S.team.length<5) S.team.push(clone(x)); } save(); renderProfile(); renderImprove(); openTeamManager(); useTeam(); });
  modal.classList.add("open");
}

/* === Dex / Bag / Equip / Profile / Rank === */
function renderDex(){const have=new Set(S.collection.map(d=>d.key));$("dex").innerHTML=POOL.map(d=>`<div class="tile" style="text-align:center;opacity:${have.has(d.key)?1:.35}"><div style="font-size:28px">${d.emoji}</div><div class="name">${d.name}</div><div class="small">${d.rarity}</div></div>`).join('');}
function renderBag(){const b=$("bag");const items=S.inv.filter(i=>i.use);if(!items.length){b.innerHTML="<div class='small'>Aucun consommable.</div>";return}b.innerHTML=items.map((it,i)=>`<div class="tile"><div class="name">${it.n}</div><div class="small">${it.desc||''}</div><button class="btn" data-use="${i}">Utiliser</button></div>`).join('');b.querySelectorAll("[data-use]").forEach(x=>x.onclick=()=>{const it=items[x.dataset.use|0];it.use(S);const idx=S.inv.indexOf(it);if(idx>-1)S.inv.splice(idx,1);save();ui();renderBag();});}
function renderEquip(){const t=$("equipTeam");t.innerHTML=S.team.slice(0,5).map((d,i)=>`<button class="btn" data-w="${i}">${d.emoji} ${d.name}</button>`).join('');t.querySelectorAll("[data-w]").forEach(b=>b.onclick=()=>openEquipModal(b.dataset.w|0));["weapon","armor","amulet"].forEach(k=>{$("slot-"+k).textContent=S.equip[k]?slotToText(S.equip[k]):"vide"});}
$("saveProfile").onclick=()=>{S.player.name=($("profileName").value||"Joueur").slice(0,20);save();renderProfile();}
function renderProfile(){ $("profileName").value=S.player.name||""; $("profileId").textContent=`ID: ${S.player.id}`; $("profileStats").innerHTML=[["Ennemis vaincus",S.player.stats.kills||0],["Or gagnÃ©",S.player.stats.goldEarned||0],["Gemmes gagnÃ©es",S.player.stats.gemsEarned||0]].map(([n,v])=>`<div class="tile"><div class="name">${n}</div><div class="badge">${v}</div></div>`).join(''); $("profileTeam").innerHTML=S.team.slice(0,5).map(d=>`<div class="tile"><div style="font-size:28px">${d.emoji}</div><div class="name">${d.name}</div><div class="small">${d.rarity}</div></div>`).join('');}
function score(){return (S.player.stats.kills||0)+Math.floor((S.gold||0)/100)+Math.floor((S.gems||0)/50)}
function renderRank(){const fake=[{n:"Rex",s:120},{n:"Nyla",s:95},{n:"Zed",s:80}];const me={n:S.player.name||"Moi",s:score()};const all=[me,...fake].sort((a,b)=>b.s-a.s).slice(0,20);$("rankList").innerHTML=all.map((u,i)=>`<div class="leader" style="${i===0?'outline:2px solid #22d3ee':''}"><div style="font-size:22px">${i+1}</div><div style="font-size:24px">ğŸ¦–</div><div style="flex:1"><div class="name">${u.n}</div><div class="small">Score ${u.s}</div></div></div>`).join('');}

/* === Summon & Chests (overlay) === */
function showOverlay(title,tiles){modalTitle.textContent=title;results.className="resultGrid";results.innerHTML=tiles;modal.classList.add("open");}
function showDinoTile(d){return `<div class="result sparkle"><div style="font-size:28px">${d.emoji}</div><div class="name">${d.name}</div><div class="small">${d.rarity}</div></div>`}
function pull(n){const cost=n===1?100:1000;if(S.gems<cost)return msg("Pas assez de gemmes");S.gems-=cost;const got=[];for(let i=0;i<n;i++){const d=rollDino();got.push(d);S.collection.push(d);if(S.team.length<5)S.team.push(clone(d));}save();ui();renderDex();useTeam();showOverlay(`Tirage x${n}`,got.map(showDinoTile).join("")); }
$("btn-pull1").onclick=()=>pull(1);$("btn-pull10").onclick=()=>pull(10);
function openChest(kind){const c=CHESTS[kind];if(S.gold<c.cost)return msg("Pas assez d'or");S.gold-=c.cost;const it=clone(c.table[Math.floor(Math.random()*c.table.length)]);S.equipCandidates.push(it);save();ui();showOverlay("Coffre obtenu",`<div class="result sparkle" style="grid-column:span 5"><div class="name">${it.n}</div><div class="small">${it.t.toUpperCase()} â€” ${it.atk?`ATK+${it.atk} `:""}${it.def?`DEF+${it.def} `:""}${it.hp?`PV+${it.hp}`:""}</div></div>`);}
$("chest-basic").onclick=()=>openChest('basic');$("chest-rare").onclick=()=>openChest('rare');$("chest-supreme").onclick=()=>openChest('supreme');
$("modalClose").onclick=()=>modal.classList.remove("open");

/* === Promo === */
$("applyPromo").onclick=()=>{const c=($("promoInput").value||"").trim().toUpperCase();if(c==="TESTDINO"){S.gold+=200000;S.gems+=50000;S.player.stats.goldEarned+=200000;S.player.stats.gemsEarned+=50000;save();ui();msg("Bonus appliquÃ© !");}else msg("Code invalide");};

/* === Reset === */
$("reset").onclick=()=>{if(confirm("Effacer la sauvegarde ?")){localStorage.removeItem("dq_save");location.reload();}};

/* === Boot === */
(function start(){ if(!S.collection.length) S.collection.push(clone(POOL[0])); if(!S.team.length) S.team.push(clone(POOL[0])); ui(); setWorld(S.lvl); useTeam(); renderDex(); renderProfile(); requestAnimationFrame(t=>{last=t;loop(t);});})();
</script>
</body></html>
